<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
      <title>
        idyll-p5
      </title>
      <meta property="og:title" content="idyll-p5">
    <meta charset="utf-8">
    <meta property="og:type" content="article">

      <meta property="og:description" content="Short description of your project">
      <meta property="description" content="Short description of your project">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div id="idyll-mount"><div class="idyll-root" data-reactroot="" data-reactid="1" data-react-checksum="-578923093"><div class="article-header" data-reactid="2"><h1 class="hed" data-reactid="3">idyll-p5</h1><h2 class="dek" data-reactid="4">Embed p5.js sketches in idyll!</h2><div class="byline" data-reactid="5"><!-- react-text: 6 -->By: <!-- /react-text --><a href="https://github.com/JobLeonard/idyll-p5" data-reactid="7">Job van der Zwan</a></div></div><p data-reactid="8"><!-- react-text: 9 -->Embed <!-- /react-text --><a href="https://p5js.org/" data-reactid="10"><!-- react-text: 11 -->p5js sketches<!-- /react-text --></a><!-- react-text: 12 --> (relatively) easily in idyll with this custom component! Source code for the component and this page <!-- /react-text --><a href="https://github.com/JobLeonard/idyll-p5" data-reactid="13"><!-- react-text: 14 -->in this github repository<!-- /react-text --></a></p><!-- react-empty: 15 --><pre data-reactid="16"><code data-reactid="17"><!-- react-text: 18 -->[Sketch webGL:1 ratio:1 sketch:`(p5) =&gt; {
  p5.draw = () =&gt; {
    const frame = p5.frameCount;
    p5.background(250);
    p5.rotateY(frame * 0.01);

    for(var j = 0; j &lt; 5; j++){
      p5.push();
      for(var i = 0; i &lt; 80; i++){
        p5.translate(
          p5.sin(frame * 0.001 + j) * 100,
          p5.sin(frame * 0.001 + j) * 100,
          i * 0.1
        );
        p5.rotateZ(frame * 0.002);
        p5.push();
        p5.sphere(8, 6, 4);
        p5.pop();
      }
      p5.pop();
    }
  }
}` /]<!-- /react-text --></code></pre><p data-reactid="19"><!-- react-text: 20 -->(WebGL example taken from <!-- /react-text --><a href="https://p5js.org/examples/3d-sine-cosine-in-3d.html" data-reactid="21"><!-- react-text: 22 -->p5js examples website<!-- /react-text --></a><!-- react-text: 23 -->)<!-- /react-text --></p><p data-reactid="24"><!-- react-text: 25 -->To embed a sketch, we have to use <!-- /react-text --><a href="https://github.com/processing/p5.js/wiki/Global-and-instance-mode" data-reactid="26"><!-- react-text: 27 -->instance mode<!-- /react-text --></a><!-- react-text: 28 -->. The code is passed as a string representing the <!-- /react-text --><em data-reactid="29"><!-- react-text: 30 -->function body<!-- /react-text --></em><!-- react-text: 31 --> of an instance mode sketch. So:<!-- /react-text --></p><pre data-reactid="32"><code data-reactid="33"><!-- react-text: 34 -->function sketch(p5){
  p5.setup = () =&gt; { /* setup code */  };
  p5.draw = () =&gt; { /* draw code */ };
  // etc.
}<!-- /react-text --></code></pre><p data-reactid="35"><!-- react-text: 36 -->Becomes:<!-- /react-text --></p><pre data-reactid="37"><code data-reactid="38"><!-- react-text: 39 -->[Sketch sketch:`(p5, options) =&gt; {
  p5.setup = () =&gt; {
    /* DO NOT USE createCanvas here! */
  };
  p5.draw = () =&gt; { /* draw code */ };
  // etc.
}` /]<!-- /react-text --></code></pre><p data-reactid="40"><!-- react-text: 41 -->There are a few more subtle differences with regular p5 code, and a few added conveniences to play nice with idyll. First, the Sketch component handles the sketch size. That is probably worth emphasizing:<!-- /react-text --></p><p data-reactid="42"><strong data-reactid="43"><!-- react-text: 44 -->IMPORTANT: DO NOT USE<!-- /react-text --></strong><code data-reactid="45"><!-- react-text: 46 -->createCanvas<!-- /react-text --></code><strong data-reactid="47"><!-- react-text: 48 -->in p5.setup!<!-- /react-text --></strong><!-- react-text: 49 --> The size depends on the container that holds the sketch, and the Sketch component handles this logic. This is explained in more detail below, at <!-- /react-text --><em data-reactid="50"><!-- react-text: 51 -->Sketch size and ratio<!-- /react-text --></em><!-- react-text: 52 -->.<!-- /react-text --></p><p data-reactid="53"><!-- react-text: 54 -->Because this function body does not have access to the global browser scope, it is passed variables via the options parameter to make life  little easier:<!-- /react-text --></p><ul data-reactid="55"><li data-reactid="56"><code data-reactid="57"><!-- react-text: 58 -->width<!-- /react-text --></code><!-- react-text: 59 --> and <!-- /react-text --><code data-reactid="60"><!-- react-text: 61 -->height<!-- /react-text --></code><!-- react-text: 62 -->, which work like the normal p<!-- /react-text --><!-- react-text: 63 -->5<!-- /react-text --><!-- react-text: 64 --> width/height. Note that this means you can use them before <!-- /react-text --><code data-reactid="65"><!-- react-text: 66 -->setup()<!-- /react-text --></code><!-- react-text: 67 -->. See <!-- /react-text --><em data-reactid="68"><!-- react-text: 69 -->“Size and ratio”<!-- /react-text --></em><!-- react-text: 70 --> below<!-- /react-text --></li><li data-reactid="71"><code data-reactid="72"><!-- react-text: 73 -->sketchProps<!-- /react-text --></code><!-- react-text: 74 -->, which can be used to pass idyll variables to the sketch. To listen to changes in these props, define a <!-- /react-text --><code data-reactid="75"><!-- react-text: 76 -->p5.receiveProps(sketchProps)<!-- /react-text --></code><!-- react-text: 77 --> function.<!-- /react-text --></li><li data-reactid="78"><code data-reactid="79"><!-- react-text: 80 -->devicePixelRatio<!-- /react-text --></code><!-- react-text: 81 -->, which matches <!-- /react-text --><code data-reactid="82"><!-- react-text: 83 -->window.devicePixelRatio<!-- /react-text --></code><!-- react-text: 84 -->. Useful in case you want to respond to zoom- or high density display-related effect on the pixels.<!-- /react-text --></li><li data-reactid="85"><code data-reactid="86"><!-- react-text: 87 -->updates<!-- /react-text --></code><!-- react-text: 88 -->, use this function to trigger an update to an Idyll variable<!-- /react-text --></li></ul><pre data-reactid="89"><code data-reactid="90"><!-- react-text: 91 -->[Sketch sketch:`(p5, { width, height }) =&gt; {
  p5.setup = () =&gt; {
    /* DO NOT USE createCanvas here! */
  };
  p5.draw = () =&gt; { /* draw code */ };
  // etc.
}` /]<!-- /react-text --></code></pre><p data-reactid="92"><!-- react-text: 93 -->any variables that are defineed in the Idyll document are automatically in the scope of the sketch function. So <!-- /react-text --></p><pre data-reactid="94"><code data-reactid="95"><!-- react-text: 96 -->[var name:&quot;x&quot; value:10 ]
[Sketch sketch:`(p5, { width, height }) =&gt; {
  p5.draw = () =&gt; { 
    // you can reference x here
    const xSquared = x * x;
  };
}` /]<!-- /react-text --></code></pre><p data-reactid="97"><!-- react-text: 98 -->The sketch unmounts and resets in response to resize events to keep a correct size. To try this out, resize the browser window, or switch between portrain/landscape if you are on mobile.<!-- /react-text --></p><p data-reactid="99"><!-- react-text: 100 -->If the sketch needs to run specific code before unmounting the component, define a <!-- /react-text --><code data-reactid="101"><!-- react-text: 102 -->p5.unmount<!-- /react-text --></code><!-- react-text: 103 --> function. If will be triggered just before the component unmounts.<!-- /react-text --></p><span style="color:red;font-style:italic;" data-reactid="104"><!-- react-text: 105 -->[mathisonian note]: <!-- /react-text --><!-- react-text: 106 -->Sorry, I temporarily broke this one.<!-- /react-text --></span><div data-reactid="107"></div><!-- react-empty: 108 --><p data-reactid="109"><!-- react-text: 110 -->Background Color: <!-- /react-text --><input type="range" step="1" min="0" max="255" value="5" data-reactid="111"/><!-- react-text: 112 -->
Line Color: <!-- /react-text --><input type="range" step="1" min="0" max="255" value="250" data-reactid="113"/></p><p data-reactid="114"><!-- react-text: 115 -->Code for the above demo:<!-- /react-text --></p><pre data-reactid="116"><code data-reactid="117"><!-- react-text: 118 -->[var name:&quot;bgColor&quot; value:5 /]
[var name:&quot;lineColor&quot; value:250 /]
[var name:&quot;sketchDemo&quot; value:`(p5, { width, height }) =&gt; {
    let size = 25;
    p5.setup = () =&gt; {
      // no createCanvas required!
    }

    p5.draw = () =&gt; {
      p5.fill(bgColor, 16);
      p5.noStroke();
      p5.rect(0, 0, width, height);
      size = 40 + 10*p5.sin(p5.frameCount * p5.PI / 60);
      p5.stroke(lineColor);
      p5.strokeWeight(size);
      p5.line(p5.mouseX, p5.mouseY, p5.pmouseX, p5.pmouseY);
    };

    p5.unmount = () =&gt; {
      console.log(&#x27;The sketch was unmounted. Width was &#x27; +
      width + &#x27;, height was &#x27; + height);
    }
}` /]

[Sketch
  sketch:sketchDemo /]

Background Color: [Range min:0 max:255 value:bgColor /]
Line Color: [Range min:0 max:255 value:lineColor /]<!-- /react-text --></code></pre><h1 data-reactid="119"><!-- react-text: 120 -->Sketch size and ratio<!-- /react-text --></h1><p data-reactid="121"><!-- react-text: 122 -->By default, the width of the sketch is equal to column width of the text, and height will be half of the width.<!-- /react-text --></p><p data-reactid="123"><!-- react-text: 124 -->You can pass a value to <!-- /react-text --><code data-reactid="125"><!-- react-text: 126 -->width<!-- /react-text --></code><!-- react-text: 127 --> and <!-- /react-text --><code data-reactid="128"><!-- react-text: 129 -->height<!-- /react-text --></code><!-- react-text: 130 --> to override this. The value can be the number of pixels like <!-- /react-text --><code data-reactid="131"><!-- react-text: 132 -->100<!-- /react-text --></code><!-- react-text: 133 -->, or a CSS-valid string like <!-- /react-text --><code data-reactid="134"><!-- react-text: 135 -->&quot;50%&quot;<!-- /react-text --></code><!-- react-text: 136 --> or <!-- /react-text --><code data-reactid="137"><!-- react-text: 138 -->&quot;2em&quot;<!-- /react-text --></code><!-- react-text: 139 -->.<!-- /react-text --></p><p data-reactid="140"><!-- react-text: 141 -->By default, height depends on width, but width does not depend on height. Passing a value to <!-- /react-text --><code data-reactid="142"><!-- react-text: 143 -->width<!-- /react-text --></code><!-- react-text: 144 --> will make <!-- /react-text --><code data-reactid="145"><!-- react-text: 146 -->height<!-- /react-text --></code><!-- react-text: 147 --> half of the new width. Passing a value to <!-- /react-text --><code data-reactid="148"><!-- react-text: 149 -->height<!-- /react-text --></code><!-- react-text: 150 --> will not affect <!-- /react-text --><code data-reactid="151"><!-- react-text: 152 -->width<!-- /react-text --></code><!-- react-text: 153 -->, which will still be as wide as the text column.<!-- /react-text --></p><p data-reactid="154"><!-- react-text: 155 -->To enforce a ratio, you can pass a number to <!-- /react-text --><code data-reactid="156"><!-- react-text: 157 -->ratio<!-- /react-text --></code><!-- react-text: 158 -->, i.e. the expression <!-- /react-text --><code data-reactid="159"><!-- react-text: 160 -->ratio:`3/1`<!-- /react-text --></code><!-- react-text: 161 --> will produce a sketch with a width three times the height.<!-- /react-text --></p><p data-reactid="162"><!-- react-text: 163 -->If no width is defined, but a height is, width depends on height (as you can see below, this part is still a bit buggy). If a ratio, width and height are defined, height is overridden to depend on width.<!-- /react-text --></p><!-- react-empty: 164 --><!-- react-empty: 165 --><!-- react-empty: 166 --><!-- react-empty: 167 --><!-- react-empty: 168 --><!-- react-empty: 169 --><pre data-reactid="170"><code data-reactid="171"><!-- react-text: 172 -->[var name:&quot;sketch_ratio&quot; value:`(p5) =&gt; {
  p5.setup = () =&gt; {
    p5.noLoop();
  };

  p5.draw = () =&gt; {
    p5.background(0);
  };
}` /]

[Sketch
  sketch:sketch_ratio /]

[Sketch
  ratio:`4/1`
  sketch:sketch_ratio /]

[Sketch
  height:50
  sketch:sketch_ratio /]

[Sketch
  ratio:`2/1`
  width:&quot;50%&quot;
  sketch:sketch_ratio /]

[Sketch
  ratio:`2/1`
  width:200
  height:200
  sketch:sketch_ratio /]

[Sketch
  ratio:`2/1`
  height:50
  sketch:sketch_ratio /]<!-- /react-text --></code></pre><h1 data-reactid="173"><!-- react-text: 174 -->Manually triggered resets<!-- /react-text --></h1><p data-reactid="175"><!-- react-text: 176 -->A <!-- /react-text --><code data-reactid="177"><!-- react-text: 178 -->watchedVal<!-- /react-text --></code><!-- react-text: 179 --> triggers a reset of the sketch whenever the value it watches is changed:<!-- /react-text --></p><div data-reactid="180"><!-- react-empty: 181 --><button data-reactid="182"><!-- react-text: 183 -->Reset Sketch!<!-- /react-text --></button></div><pre data-reactid="184"><code data-reactid="185"><!-- react-text: 186 -->[var name:&quot;resetSketch&quot; value:0 /]
[var name:&quot;sketch_reset&quot; value:`(p5, {width, height}) =&gt; {
  let x = width/2, y = height/2, dx = 0;

  p5.draw = () =&gt; {
    p5.fill(0, 4);
    p5.noStroke();
    p5.rect(0, 0, width, height);
    p5.stroke(256);
    const dx_scaled = dx / (1&lt;&lt;4);
    p5.strokeWeight(20 + dx_scaled);
    p5.line(x, y, x+dx_scaled, y);
    x = (x+dx_scaled)%width;
    p5.line(x-dx_scaled, y, x, y);
    dx++;
  };
 }` /]

[Sketch
  height:100
  watchedVal:resetSketch
  sketch:sketch_reset /]
[Button onClick:`resetSketch++`]Reset Sketch![/Button]<!-- /react-text --></code></pre></div></div>
    <script src="index.js"></script>
  </body>
</html>
